<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÃŽle</title>
  <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    html, body { margin: 0; height: 100%; }
    body {
      background: #1a1a1a;
      font-family: "Pixelify Sans", monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #3e2723;
    }
    .game-wrapper {
      aspect-ratio: 9 / 16;
      width: min(60vh, 90vw);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
      background: #000;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
      border: 2px solid #333;
    }
    .scanlines {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
      background-size: 100% 4px;
      pointer-events: none;
      z-index: 50;
    }

    /* --- BOUTONS DE CONTRÃ”LE (HOME & MUTE) --- */
    .top-controls {
      position: absolute;
      top: 15px;
      right: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 100;
    }

    .btn-pixel {
      width: 44px; height: 44px;
      background-color: #fff1e0; border: 3px solid #3e2723;
      border-radius: 50%; cursor: pointer;
      display: flex; justify-content: center; align-items: center;
      box-shadow: 0 4px 0 rgba(0,0,0,0.2); padding: 0;
    }

    .btn-pixel:active { transform: translateY(2px); box-shadow: 0 2px 0 rgba(0,0,0,0.1); }

    .btn-pixel img {
      width: 24px; height: auto;
      image-rendering: pixelated; pointer-events: none;
    }

    .scene {
      flex: 1;
      position: relative;
      overflow: hidden;
      background-color: #333;
      image-rendering: pixelated;
    }

    /* --- AMPOULE INDICE --- */
    .hint-bulb {
      position: absolute;
      top: 15px;
      left: 15px;
      width: 40px;
      height: 40px;
      background-color: #fff1e0;
      border: 3px solid #3e2723;
      border-radius: 8px;
      display: none;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      z-index: 60;
      font-size: 24px;
      animation: pulse 1.5s infinite;
      box-shadow: 0 4px 0 rgba(0,0,0,0.2);
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); background-color: #ffd54f; }
      100% { transform: scale(1); }
    }

    .indice-image {
      position: absolute;
      bottom: 15%;
      left: 50%;
      transform: translateX(-50%);
      max-width: 80%;
      image-rendering: pixelated;
      z-index: 5;
      display: none;
    }

    .dialogue-box {
      width: 100%;
      background-color: #fff1e0;
      border-top: 4px solid #3e2723;
      padding: 20px;
      position: relative;
      cursor: pointer;
      z-index: 10;
    }
    .text { font-size: 1.4rem; line-height: 1.4; min-height: 4.2em; }
    .choices { margin-top: 10px; border-top: 2px dashed rgba(62, 39, 35, 0.3); padding-top: 5px; }
    .choices:empty { border-top: none; }
    
    .choice-btn {
      display: block; width: 100%; text-align: left; padding: 8px 0;
      background: none; border: none; cursor: pointer; font-family: inherit;
      font-size: 1.2rem; color: #5d4037;
    }
    .choice-btn:hover { color: #d32f2f; padding-left: 10px; font-weight: bold; }
    .choice-btn::before { content: "âž¤ "; opacity: 0; }
    .choice-btn:hover::before { opacity: 1; }

    .arrow {
      position: absolute; bottom: 10px; right: 15px; font-size: 24px;
      color: #d32f2f; display: none; animation: bounce 1s infinite;
    }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(3px); } }
  </style>
</head>
<body>

  <audio id="bgMusic" src="/Sons/ocean.mp3" loop></audio>
  <audio id="clickSound" src="/Sons/pop.mp3"></audio>
  
  <div class="game-wrapper">
    <div class="scanlines"></div>

    <div class="top-controls">
      <button class="btn-pixel" id="homeBtn">
        <img src="Images/home.png" alt="Home">
      </button>
      <button class="btn-pixel" id="muteBtn">
        <img src="Images/unmute.png" id="muteIcon" alt="Mute">
      </button>
    </div>

    <div class="scene" id="scene">
      <div id="hintBulb" class="hint-bulb">ðŸ’¡</div>
      <img id="indiceImage" class="indice-image">
    </div>

    <div class="dialogue-box" id="dialogueBox">
      <div class="text" id="text"></div>
      <div class="choices" id="choices"></div>
      <div class="arrow" id="arrow">â–¼</div>
    </div>
  </div>

<script>
  const texts = { 
    pont: [ "J'espÃ¨re bientÃ´t arriver." ], 
    ile_loin: [ "Terre! \n j'apperÃ§ois une Ã®le!", "Elle semble dÃ©serte.", "C'est une croix sur la plage ?" ], 
    ile_proche: [ "Une croix est dessinÃ©e sur le sol.", "C'est pas discret discret hein.", "Heuresement que j'ai pris ma pelle" ], 
    ile_trou: [ "Pfiout c'Ã©tait loooooooooooooooooooooooooooong", "Alors, qu'est ce qu'on a lÃ  ?" ], 
    journal: [ "On dirait un journal de bord", "C'est peut-Ãªtre celui de Barbe d'Or." ], 
    journal_ouvert: [ "Hein ?", "Mais qu'est ce que c'est que Ã§a ???" ] 
  };

  const backgrounds = {
    pont: "url('Images/pont.png')",
    ile_loin: "url('Images/ile_loin.png')",
    ile_proche: "url('Images/ile_proche.png')",
    ile_trou: "url('Images/ile_trou.png')",
    journal: "url('Images/ile_trou.png')",
    journal_ouvert: "url('Images/ile_trou.png')"
  };

  const indiceImages = {
    journal: "Images/journal_ferme.png",
    journal_ouvert: "Images/journal_ouvert.png"
  };

  const progression = {
    pont: { label: "S'approcher de l'avant", next: "ile_loin" },
    ile_loin: { label: "Souquer les artimuses", next: "ile_proche" },
    ile_proche: { label: "Creuser", next: "ile_trou" },
    ile_trou: { label: "Examiner l'objet", next: "journal" },
    journal: { label: "Ouvrir le journal", next: "journal_ouvert" }
  };

  let currentText = "pont";
  let dialogues = texts[currentText];
  let index = 0;
  let isTyping = false;
  let musicStarted = false;

  const textEl = document.getElementById("text");
  const arrowEl = document.getElementById("arrow");
  const dialogueBox = document.getElementById("dialogueBox");
  const choicesEl = document.getElementById("choices");
  const sceneEl = document.getElementById("scene");
  const indiceEl = document.getElementById("indiceImage");
  const hintBulb = document.getElementById("hintBulb");
  
  const music = document.getElementById("bgMusic");
  const clickSfx = document.getElementById("clickSound");
  const muteBtn = document.getElementById("muteBtn");
  const muteIcon = document.getElementById("muteIcon");
  const homeBtn = document.getElementById("homeBtn");

  function playClick() {
    clickSfx.currentTime = 0;
    clickSfx.play().catch(() => {});
  }

  function startMusic() {
    if (!musicStarted) {
      music.volume = 0.3;
      music.play().catch(() => {});
      musicStarted = true;
    }
  }

  function updateBackground() {
    sceneEl.style.backgroundImage = backgrounds[currentText];
    sceneEl.style.backgroundRepeat = "no-repeat";
    sceneEl.style.backgroundPosition = "center bottom";
    sceneEl.style.backgroundSize = "cover";

    if (indiceImages[currentText]) {
      indiceEl.src = indiceImages[currentText];
      indiceEl.style.display = "block";
    } else {
      indiceEl.style.display = "none";
    }

    if (currentText === "journal_ouvert") {
      hintBulb.style.display = "flex";
    } else {
      hintBulb.style.display = "none";
    }
  }

  function typeText() {
    isTyping = true;
    arrowEl.style.display = "none";
    choicesEl.innerHTML = "";
    textEl.textContent = "";

    const current = dialogues[index];
    let charIndex = 0;

    const interval = setInterval(() => {
      textEl.textContent += current[charIndex++];
      if (charIndex >= current.length) {
        clearInterval(interval);
        isTyping = false;
        if (index < dialogues.length - 1) arrowEl.style.display = "block";
        else if (progression[currentText]) showChoices();
      }
    }, 40);
  }

  function showChoices() {
    choicesEl.innerHTML = "";
    const step = progression[currentText];
    if (step) {
      const btn = document.createElement("button");
      btn.className = "choice-btn";
      btn.textContent = step.label;
      btn.onclick = (e) => { 
        e.stopPropagation(); 
        playClick();
        goToScene(step.next); 
      };
      choicesEl.appendChild(btn);
    }
  }

  function goToScene(scene) {
    currentText = scene;
    dialogues = texts[scene];
    index = 0;
    updateBackground();
    typeText();
  }

  function nextDialogue() {
    if (isTyping) return;
    index++;
    if (index < dialogues.length) {
      typeText();
    }
  }

  // --- EVENTS BOUTONS ---
  muteBtn.onclick = (e) => {
    e.stopPropagation();
    playClick();
    music.muted = !music.muted;
    muteIcon.src = music.muted ? "Images/mute.png" : "Images/unmute.png";
  };

  homeBtn.onclick = (e) => {
    e.stopPropagation();
    playClick();
    setTimeout(() => { location.href = 'accueil.html'; }, 150);
  };

  hintBulb.onclick = (e) => {
    e.stopPropagation();
    alert("Prends la mer pour en savoir plus");
  };

  dialogueBox.addEventListener("click", () => {
    startMusic();
    if (!choicesEl.children.length) {
      playClick();
      nextDialogue();
    }
  });

  updateBackground();
  typeText();
</script>
</body>

</html>
